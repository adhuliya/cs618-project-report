%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
This report documents the work done to port the constraint generation plugin from
\verb+GCC 4.7.2+ to \verb+GCC 5.2.0+. The constraint generation plugin extracts the pointer based constraints from the GIMPLE IR during LTO (Link Time Optimization) phase and dumps them in an output file. These constraints are then used for many other pointer analysis based optimizations developed in-house.

The rest of the report documents the general approach followed to port the plugin; then the list of contraints detected by the plugin are listed with test cases; then the  pattern of changes observed from \verb+GCC 4.7.2+ to \verb+GCC 5.2.0+ are listed (although not exhaustive); and at last the future work discusses the work remaining.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Approach Followed}\label{sec:appoach-followed}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
This section summarises the approach followed to port the plugin. We believe this might help us to port other (if any) plugins in the future. Some of the methods are specific for this plugin. We tried understanding the code before making changes, but the direct source level changes eventually gave much quicker results. The  basic approachs are enumerated below:

\begin{enumerate}
    \item Compilation was the first problem. So we adopted the incremental apporach where we added source code in logical units, files, functions etc. This helped us tackle small number of issues at a time. The functions were added by following the call hirarchy from the top. This helped us include only those functions that were reachable/used. This helped reduce the size of the code drastically.

    \item How to adapt the source code was another problem. Here we compared the tree-ssa-structalias.c in \verb+GCC 4.7.2+ and \verb+GCC 5.2.0+, and most of the differences were straight forward to understand. This worked because, the plugin was an adaptation of tree-ssa-structalias.c in \verb+GCC 4.7.2+.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{List of Constraints Generated by the Plugin}\label{sec:constraints}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
This section tries to enumerate all possible constraints. Each test-case and its constraints are listed below.

The programs have been created with some naming conventions of variables to make it easy to understant the type of constraints when reading. \prettyref{table:varname} outlines the names and their associated meaning.

\begin{table}
\begin{center}
    \begin{tabular}{| m{10ex} | m{70ex} |}
    \hline
    \textbf{Name} & \textbf{Meaning} \\
    \hline
    \hline
    i & Read `i' as `integer'. \\
    \hline
    pi & Read `pi' as `pointer-to integer'.\\
    \hline
    ppi & Read `ppi' as `pointer-to pointer-to integer'. Therefore, *ppi would be a pointer-to interger. \\
    \hline
    piA, piB & Read `piA' as  `pointer-to integer A'. Capital letter suffixes like A, B, \ldots{} are used only to make the names distinct. \\
    \hline
    f & Read `f' as `function'.\\
    \hline
    fA, fB & Functions with different names. Capital letter suffixes like A, B, \ldots{} are used to make the names distinct. Read `fA' as `function A'.\\
    \hline
    fp & Read `fp' as `function parameter'. Note that here `p' is used after `f' and hence is no more read as `points-to'.\\
    \hline
    \end{tabular}
    \caption{Testcase variables naming conventions}
    \label{table:varname}
\end{center}
\end{table}

\subsection{List of Test Programs}

\prettyref{fig:test-01}, \prettyref{fig:test-02}, \prettyref{fig:test-03}, \prettyref{fig:test-04}, \prettyref{fig:test-05}, give the programs used to build the constraints.
 
\begin{figure}
\label{fig:test-01}
\lstinputlisting[language=C]{resources/test-01.c}
\caption{test-01.c}
\end{figure}

\begin{figure}
\label{fig:test-02}
\lstinputlisting[language=C]{resources/test-02.c}
\caption{test-02.c}
\end{figure}

\begin{figure}
\label{fig:test-03}
\lstinputlisting[language=C]{resources/test-03.c}
\caption{test-03.c}
\end{figure}

\begin{figure}
\label{fig:test-04}
\lstinputlisting[language=C]{resources/test-04.c}
\caption{test-04.c}
\end{figure}

\begin{figure}
\label{fig:test-05}
\lstinputlisting[language=C]{resources/test-05.c}
\caption{test-05.c}
\end{figure}

\subsection{List of Constraints}
\prettyref{table:expr-constr} gives the list of constraints for each possible expressing.

    \begin{center}
        \begin{longtable}{| m{15ex} | m{30ex} | m{25ex} | m{20ex} | m{10ex}|}
\caption{Constraints on Expressions\label{table:expr-constr}} \\
\hline
\textbf{\textcolor{BrickRed}{Expression}} & \textbf{\textcolor{BrickRed}{Comment}} & \textbf{\textcolor{BrickRed}{Offset}} & \textbf{\textcolor{BrickRed}{Type}} & \textbf{\textcolor{BrickRed}{ptr\_{}arth}}\\ 
\hline
\hline
\textcolor{RoyalBlue}{\textbf{pi}} & 
&
\texttt{0} &
\texttt{0} &
\texttt{0} \\
\hline
\textcolor{RoyalBlue}{\textbf{pi + 4}} & 
RHS only&
\texttt{32} &   %offset
\texttt{0} &    %type
\texttt{1} \\   %ptr_arth
\hline
\textcolor{RoyalBlue}{\textbf{pi + -4}} & 
RHS only&
\texttt{18446744073709551584} &   %offset
\texttt{0} &    %type
\texttt{1} \\   %ptr_arth
\hline
\textcolor{RoyalBlue}{\textbf{*pi}} & 
Var use only&
\texttt{0} &   %offset
\texttt{--} &    %type
\texttt{--} \\   %ptr_arth
\hline
\textcolor{RoyalBlue}{\textbf{0}} & 
RSH only, NULL assignmt&
\texttt{0} &   %offset
\texttt{2} &    %type
\texttt{0} \\   %ptr_arth
\hline
\textcolor{RoyalBlue}{\textbf{17}} & 
RSH only, \textcolor{BrickRed}{Not generated} &
\texttt{--} &   %offset
\texttt{--} &    %type
\texttt{--} \\   %ptr_arth
\hline
\textcolor{RoyalBlue}{\textbf{f (pi)}} & 
Same as `pifp = pi' &
\texttt{--} &   %offset
\texttt{--} &    %type
\texttt{--} \\   %ptr_arth
%\hline
%\textcolor{RoyalBlue}{\textbf{pi}} & 
%Comment &
%\texttt{Offset} &
%\texttt{type} &
%\texttt{ptr arth} \\
\hline
        \end{longtable}
    \end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Future Work}\label{sec:future-work}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{enumerate}
    \item The plugin source has to be logically understood.
    \item A C constraint has to added. The C contraint, where a pointer is assigned an arbitrary integer (other than NULL) is not currently detected by the plugin.
    \item C++ constraints have to be included too.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Appendix A : Change Patterns}\label{sec:change-patterns}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The following table lists the significant changes performed on the sourcecode while porting. (This table is not a complete listing)

\input{table1}

\input{table2}

